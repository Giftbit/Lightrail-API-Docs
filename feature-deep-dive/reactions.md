# Reactions

[Lightrail](https://www.lightrail.com) Reactions provides an endpoint for your own outbound webhook to send messages and configure actions to happen in Lightrail based on those messages.

## Input

Sending messages or events to Reactions is easy.  Just POST to https://www.lightrail.com/v1/react/input with a JSON body and your API key in the Authorization header.  There are no restrictions on the format of the body.

### Idemotency

The world is messy.  Network connections can fail and cause messages to be processed multiple times.  To ensure that messages are not processed multiple times put a unique identifier on your message.  Reactions will look for the following keys on the JSON object in order: `id`, `messageId`, `message_id`, `eventId`, `event_id`, `sg_message_id`.  If any of these are found then that message is uniquely identified and even if it is sent multiple times it will only be processed once.

### Example

In this example we're sending a message generated by (analytics-node)[https://github.com/segmentio/analytics-node].  This is a referral event with both a referrer and referee email address.  We'll use this message later in a reaction that gives each an account credit.

```bash
curl -i \
    -H "Accept: application/json" \
    -H "Authorization: Bearer <your API key>" \
    -X POST \
    -d '{"_metadata":{"nodeVersion":"8.2.1"},"channel":"server","context":{"library":{"name":"analytics-node","version":"3.0.0"}},"event":"referral","integrations":{},"messageId":"referral1","originalTimestamp":"2017-08-16T23:42:02.967Z","projectId":"L8gWftAYKw","properties":{"referrer":{"email":"helpfulfriend@example.com"},"referee":{"email":"newcustomer@example.com"}},"receivedAt":"2017-08-16T23:42:13.916Z","sentAt":"2017-08-16T23:42:12.971Z","timestamp":"2017-08-16T23:42:03.912Z","type":"track","userId":"f4ca124298","version":2,"writeKey":"bRX974cvHemu3bsBpGhFqfheTBtmtLgC"}' \
    https://api.lightrail.com/v1/react/input
```

```javascript
var request = require('request');

var msg = {
  "_metadata": {
    "nodeVersion": "8.2.1"
  },
  "channel": "server",
  "context": {
    "library": {
      "name": "analytics-node",
      "version": "3.0.0"
    }
  },
  "event": "referral",
  "integrations": {},
  "messageId": "referral1",
  "originalTimestamp": "2017-08-16T23:42:02.967Z",
  "projectId": "L8gWftAYKw",
  "properties": {
    "referrer": {
      "email": "helpfulfriend@example.com"
    },
    "referee": {
      "email": "newcustomer@example.com"
    }
  },
  "receivedAt": "2017-08-16T23:42:13.916Z",
  "sentAt": "2017-08-16T23:42:12.971Z",
  "timestamp": "2017-08-16T23:42:03.912Z",
  "type": "track",
  "userId": "f4ca124298",
  "version": 2,
  "writeKey": "bRX974cvHemu3bsBpGhFqfheTBtmtLgC"
};

request.post({
    url: "https://api.lightrail.com/v1/react/input",
    json: true,
    body: JSON.stringify(msg)
}, function(error, httpResponse, body){
    if (error) {
        console.error(error);
    }
});
```
